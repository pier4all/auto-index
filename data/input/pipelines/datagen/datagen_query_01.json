{
  "aggregate":"datagen-01-review-booked-hours",
  "pipeline":[
    {
      "$match": {
        "ref-employee": "{$EMPLOYEE}", 
        "date": {
          "$gte": "{$START_DATE}", 
          "$lt": "{$END_DATE}"
        }
      } 
    }, {
      "$group": {
        "_id": "$ref-project",
        "total_hours": {
          "$sum": "$quantity"
        },
        "bookings": {
          "$push": {
            "date": "$date",
            "hours": "$quantity"
          }
        } 
      }
    }, {
      "$lookup": {
        "from": "projects",
        "localField": "_id",
        "foreignField": "_id",
        "as": "project"
      } 
    }, {
      "$addFields": {
        "project_name": {
          "$first": "$project.title"
        }
      } 
    }, {
      "$project": {
        "project_name": 1,
        "total_hours": "$total_hours",
        "items": "$bookings",
        "totally_invoiced": "$amount"
      } 
    }, {
      "$sort": {
        "total_hours": -1
      } 
    }
  ],
  "collection": "timesheets",
  "allowDiskUse":true,
  "maxTimeMS":0,
  "cursor":{}
}